---
// src/pages/[lang].astro
import { loadCv } from "@/utils/loadCv";
import { config } from "@/utils/config";
import OptionsFab from "@/components/OptionsFab.astro";
import Seo from "@/components/seo/Seo.astro";
import "@/styles/global.css";

// IMPORT THEME INDEX
import { themes } from "@/themes";

export function getStaticPaths() {
  return config.i18n.locales.map((lang) => ({
    params: { lang },
  }));
}

const { lang } = Astro.params;
const cv = await loadCv(lang);

// ----------------------------------------------------------------------------
// THEME & FONT RESOLUTION
// ----------------------------------------------------------------------------
const themeName = config.theme.name;
const activeTheme = themes[themeName] || themes["minimal"];

if (!activeTheme) {
  throw new Error(`CRITICAL: Theme '${themeName}' not found.`);
}

const { component: ThemeComponent, manifest } = activeTheme;

// Manifest has a accent color if not deafult orange
const accentColor = activeTheme.manifest.colors?.accent || "#ea580c";
// User Config > Theme Manifest > System Default
const userFonts = config.ui?.fonts || {};
const themeFonts = manifest.fonts || {};

const fonts = {
  url: themeFonts.googleFontsUrl || userFonts.googleFontsUrl,
  body: themeFonts.body || userFonts.body || "sans-serif",
  heading: themeFonts.heading || userFonts.heading || "sans-serif",
  mono: themeFonts.mono || userFonts.mono || "monospace",
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <Seo
      title={`${cv.basics.name} - ${cv.basics.label}`}
      description={cv.basics.summary}
      lang={lang}
      image={cv.basics.image}
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    {fonts.url && <link href={fonts.url} rel="stylesheet" />}

    <style
      define:vars={{
        fontMain: fonts.body,
        fontHeading: fonts.heading,
        fontMono: fonts.mono,
      }}
    >
      :root {
        --font-main: var(--fontMain);
        --font-heading: var(--fontHeading);
        --font-mono: var(--fontMono);
      }
    </style>
  </head>

  <body
    class="bg-slate-50 text-slate-900 font-sans antialiased min-h-screen flex flex-col selection:bg-indigo-100 selection:text-indigo-900"
  >
    <div class="flex-grow">
      <ThemeComponent cv={cv} />
    </div>

    <OptionsFab />

    <footer
      class="mt-auto w-full max-w-5xl mx-auto px-6 pb-12 pt-20 print:hidden"
    >
      <div
        class="w-full h-px mb-6 opacity-20"
        style={{ backgroundColor: accentColor }}
      >
      </div>

      <div
        class="flex flex-col md:flex-row justify-between items-center gap-4 text-xs opacity-70"
      >
        <div class="flex items-center gap-2">
          <span
            class="w-2 h-2 rounded-full shadow-[0_0_8px_currentColor]"
            style={{ backgroundColor: accentColor, color: accentColor }}></span>

          <span
            class="uppercase tracking-widest font-bold"
            style={{
              fontFamily: fonts.mono,
              color: accentColor,
            }}
          >
            {themeName} Theme
          </span>
        </div>

        <div
          class="flex flex-col md:items-end gap-1 text-zinc-500 dark:text-zinc-400 text-center md:text-right"
        >
          <p>
            &copy; {new Date().getFullYear()}
            {cv.basics.name}. All rights reserved.
          </p>

          <p>
            Deployed with
            <a
              href="https://github.com/TU-USUARIO/open-portfolio"
              target="_blank"
              class="font-bold hover:underline transition-all"
              style={{ color: accentColor }}
            >
              Open Portfolio
            </a>
          </p>
        </div>
      </div>
    </footer>
  </body>
</html>
