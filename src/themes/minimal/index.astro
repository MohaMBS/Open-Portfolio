---
import type { CV } from "@/schemas/cv";
import { Image } from "astro:assets";

interface Props {
  cv: CV;
}

const { cv } = Astro.props;
const { basics, work, skills, projects, education } = cv;

const Icons = {
  GitHub: `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>`,
  LinkedIn: `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>`,
  Mail: `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>`,
  Globe: `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>`,
  Phone: `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>`,
  Link: `<svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`,
  MapPin: `<svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>`,
};

function getSocialIcon(network: string) {
  if (network.toLowerCase().includes("github")) return Icons.GitHub;
  if (network.toLowerCase().includes("linkedin")) return Icons.LinkedIn;
  return Icons.Globe;
}
---

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
  rel="stylesheet"
/>

<style is:global>
  :root {
    --font-sans: "Inter", system-ui, -apple-system, sans-serif;
  }
  body {
    font-family: var(--font-sans);
    background-color: #f3f4f6;
    color: #111827;
    line-height: 1.5;
  }

  @media print {
    body {
      background-color: white;
      font-size: 11px;
    }
    .print-hidden {
      display: none !important;
    }
    .page-shadow {
      box-shadow: none !important;
    }
    .page-container {
      width: 100% !important;
      max-width: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    a {
      text-decoration: none;
      color: black;
    }
    section {
      break-inside: avoid;
    }
    h2 {
      break-after: avoid;
    }
  }
</style>

<main class="min-h-screen py-8 md:py-12 px-4 print:p-0 print:py-0">
  <div
    class="page-container max-w-3xl mx-auto bg-white p-8 md:p-12 border border-slate-200 print:border-none"
  >
    <header
      class="flex flex-col-reverse md:flex-row justify-between items-start gap-6 mb-10 border-b border-slate-200 pb-8"
    >
      <div class="flex-1 space-y-3">
        <div>
          <h1
            class="text-3xl md:text-4xl font-bold tracking-tight text-slate-900"
          >
            {basics.name}
          </h1>
          <p class="text-lg text-slate-500 font-medium mt-1">
            {basics.label}
          </p>
        </div>

        <div class="flex flex-wrap gap-x-4 gap-y-2 text-sm text-slate-600 mt-4">
          {
            basics.location && (
              <div class="flex items-center gap-1.5">
                <span class="text-slate-400">
                  <Fragment set:html={Icons.MapPin} />
                </span>
                {basics.location.city}, {basics.location.countryCode}
              </div>
            )
          }

          {
            basics.email && (
              <a
                href={`mailto:${basics.email}`}
                class="flex items-center gap-1.5 hover:text-slate-900 transition-colors"
              >
                <span class="text-slate-400">
                  <Fragment set:html={Icons.Mail} />
                </span>
                {basics.email}
              </a>
            )
          }

          {
            basics.phone && (
              <a
                href={`tel:${basics.phone}`}
                class="flex items-center gap-1.5 hover:text-slate-900 transition-colors"
              >
                <span class="text-slate-400">
                  <Fragment set:html={Icons.Phone} />
                </span>
                {basics.phone}
              </a>
            )
          }

          {
            basics.profiles &&
              basics.profiles.map((profile) => (
                <a
                  href={profile.url}
                  target="_blank"
                  class="flex items-center gap-1.5 hover:text-slate-900 transition-colors"
                >
                  <span class="text-slate-400">
                    <Fragment set:html={getSocialIcon(profile.network)} />
                  </span>
                  <span class="print:hidden">{profile.network}</span>
                  <span class="hidden print:inline">
                    {profile.username || profile.network}
                  </span>
                </a>
              ))
          }
        </div>
      </div>

      {
        basics.image && (
          <div class="shrink-0">
            <Image
              src={basics.image}
              alt={basics.name}
              width={120}
              height={120}
              class="w-24 h-24 md:w-32 md:h-32 rounded-lg object-cover grayscale hover:grayscale-0 transition-all duration-500 border border-slate-200"
            />
          </div>
        )
      }
    </header>

    {
      basics.summary && (
        <section class="mb-10">
          <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-3 pb-1 border-b border-slate-200">
            Perfil
          </h2>
          <p class="text-slate-600 leading-relaxed text-sm md:text-base text-justify">
            {basics.summary}
          </p>
        </section>
      )
    }

    {
      work && work.length > 0 && (
        <section class="mb-10">
          <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-6 pb-1 border-b border-slate-200">
            Experiencia Profesional
          </h2>

          <div class="space-y-8">
            {work.map((job) => (
              <div class="group">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline mb-2">
                  <div class="flex flex-col sm:flex-row sm:items-baseline gap-1 sm:gap-3">
                    <h3 class="font-bold text-slate-900 text-base">
                      {job.position}
                    </h3>
                    <span class="hidden sm:inline text-slate-300">•</span>
                    <div class="font-medium text-slate-700">
                      {job.url ? (
                        <a
                          href={job.url}
                          target="_blank"
                          class="hover:underline"
                        >
                          {job.name}
                        </a>
                      ) : (
                        job.name
                      )}
                    </div>
                  </div>

                  <div class="text-sm font-medium text-slate-500 tabular-nums shrink-0">
                    {job.startDate} — {job.endDate || "Actualidad"}
                  </div>
                </div>

                {job.summary && (
                  <p class="text-sm text-slate-600 mb-3 leading-relaxed">
                    {job.summary}
                  </p>
                )}

                {job.highlights && (
                  <ul class="list-disc list-outside ml-4 space-y-1">
                    {job.highlights.map((highlight) => (
                      <li class="text-sm text-slate-600 pl-1 marker:text-slate-300">
                        {highlight}
                      </li>
                    ))}
                  </ul>
                )}
              </div>
            ))}
          </div>
        </section>
      )
    }

    {
      education && education.length > 0 && (
        <section class="mb-10">
          <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-6 pb-1 border-b border-slate-200">
            Educación
          </h2>
          <div class="space-y-4">
            {education.map((edu) => (
              <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start">
                <div>
                  <h3 class="font-bold text-slate-900">{edu.institution}</h3>
                  <p class="text-sm text-slate-600">
                    {edu.studyType}, {edu.area}
                  </p>
                </div>
                <div class="text-sm text-slate-500 tabular-nums mt-1 sm:mt-0">
                  {edu.startDate} — {edu.endDate || "Presente"}
                </div>
              </div>
            ))}
          </div>
        </section>
      )
    }

    {
      skills && skills.length > 0 && (
        <section class="mb-10">
          <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4 pb-1 border-b border-slate-200">
            Habilidades
          </h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
            {skills.map((skillGroup) => (
              <div>
                <span class="font-bold text-slate-800 text-sm block mb-1">
                  {skillGroup.name}
                </span>
                <div class="text-sm text-slate-600 leading-relaxed">
                  {skillGroup.keywords.join(", ")}
                </div>
              </div>
            ))}
          </div>
        </section>
      )
    }

    {
      projects && projects.length > 0 && (
        <section class="print:break-before-auto">
          <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-6 pb-1 border-b border-slate-200">
            Proyectos
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {projects.map((project) => (
              <a
                href={project.url || project.github}
                target="_blank"
                class="block p-4 rounded border border-slate-200 hover:border-slate-400 transition-colors no-underline group"
              >
                <div class="flex justify-between items-start mb-2">
                  <h3 class="font-bold text-slate-900 text-sm group-hover:underline">
                    {project.name}
                  </h3>
                  {project.isActive && (
                    <span class="w-1.5 h-1.5 rounded-full bg-green-500" />
                  )}
                </div>
                <p class="text-xs text-slate-600 mb-2 line-clamp-2">
                  {project.description}
                </p>
                <div class="flex flex-wrap gap-1">
                  {project.keywords?.slice(0, 3).map((k) => (
                    <span class="text-[10px] text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded">
                      {k}
                    </span>
                  ))}
                </div>
              </a>
            ))}
          </div>
        </section>
      )
    }
  </div>
</main>
