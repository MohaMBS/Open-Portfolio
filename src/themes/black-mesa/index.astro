---
import type { CV } from '@/schemas/cv';

interface Props {
  cv: CV;
}

const { cv } = Astro.props;
const { basics, work, skills, projects } = cv;

const LambdaIcon = `<svg viewBox="0 0 32 32" class="w-full h-full fill-current"><path d="M16 0C7.163 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm-1.5 24h-4l6-14h2l6 14h-4l-1-3h-4l-1 3zm2.5-10.5L15.5 18h3L17 13.5z"/></svg>`;
const HealthIcon = `<svg viewBox="0 0 24 24" fill="currentColor" class="w-full h-full"><path d="M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/></svg>`;
---

<style is:global>
  body {
    margin: 0;
    background-color: #050505 !important;
    overflow-x: hidden;
  }
  .font-military { font-family: 'Black Ops One', system-ui, sans-serif; }
  .font-terminal { font-family: 'Share Tech Mono', monospace; }
  .bg-noise {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
  }
  .scanlines {
    background: linear-gradient(
      to bottom,
      rgba(255, 255, 255, 0),
      rgba(255, 255, 255, 0) 50%,
      rgba(0, 0, 0, 0.2) 50%,
      rgba(0, 0, 0, 0.2)
    );
    background-size: 100% 4px;
    pointer-events: none;
  }
  .hazard-stripes {
    background-image: repeating-linear-gradient(
      45deg,
      #000,
      #000 10px,
      #ea580c 10px,
      #ea580c 20px
    );
  }

  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
  .animate-blink { animation: blink 2s infinite; }
  
  @keyframes slide-in { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  .animate-slide-in { animation: slide-in 0.5s ease-out forwards; }
</style>

<div class="min-h-screen text-gray-300 font-terminal selection:bg-orange-500 selection:text-black flex flex-col relative">
  
  <div class="fixed inset-0 z-50 pointer-events-none scanlines opacity-30 h-full w-full"></div>
  <div class="fixed inset-0 z-0 pointer-events-none bg-noise opacity-20 h-full w-full"></div>
  
  <div class="relative z-10 w-full max-w-7xl mx-auto p-4 md:p-8 flex-1 flex flex-col gap-8">

    <header class="border-b-4 border-orange-600 bg-zinc-900/90 backdrop-blur p-4 flex flex-col md:flex-row justify-between items-center gap-6 shadow-[0_0_30px_rgba(234,88,12,0.15)]">
        
        <div class="flex items-center gap-4 w-full md:w-auto">
            <div class="w-12 h-12 md:w-14 md:h-14 text-orange-500 bg-black rounded-full p-2 border border-orange-500/50 shrink-0">
                <Fragment set:html={LambdaIcon} />
            </div>
            <div>
                <h1 class="text-3xl md:text-5xl font-military text-orange-500 leading-none tracking-wider">
                    BLACK MESA
                </h1>
                <div class="text-[10px] md:text-xs text-orange-400/60 tracking-[0.3em] uppercase mt-1">
                    Personnel Record Database
                </div>
            </div>
        </div>

        <div class="flex items-center gap-4 text-xs font-bold font-mono w-full md:w-auto justify-between md:justify-end bg-black/50 p-3 rounded border border-zinc-800">
            <div class="text-right px-2">
                <div class="text-zinc-500 text-[10px]">CLEARANCE</div>
                <div class="text-orange-500">LEVEL 4</div>
            </div>
            <div class="w-px h-8 bg-zinc-700"></div>
            <div class="text-right px-2">
                <div class="text-zinc-500 text-[10px]">STATUS</div>
                <div class="text-green-500 animate-blink">ONLINE</div>
            </div>
        </div>
    </header>


    <section class="grid grid-cols-1 lg:grid-cols-12 gap-6 animate-slide-in">
        
        <div class="lg:col-span-4 bg-black border-2 border-zinc-700 relative group overflow-hidden">
            <div class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-orange-600 z-20"></div>
            <div class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-orange-600 z-20"></div>
            
            <div class="relative w-full aspect-square bg-zinc-900 flex items-center justify-center">
                {basics.image ? (
                    <img src={basics.image} alt={basics.name} class="w-full h-full object-cover filter grayscale sepia contrast-125 brightness-90 group-hover:filter-none transition duration-500" />
                ) : (
                    <div class="flex flex-col items-center gap-2 text-orange-500/50">
                        <span class="text-4xl">⚠</span>
                        <span class="font-military">NO SIGNAL</span>
                    </div>
                )}
                <div class="absolute inset-0 bg-gradient-to-b from-transparent via-green-500/10 to-transparent h-[10%] w-full animate-[scanline_3s_linear_infinite] pointer-events-none"></div>
            </div>
        </div>

        <div class="lg:col-span-8 flex flex-col gap-4">
            <div class="bg-zinc-900/80 border-l-4 border-orange-500 p-6 flex flex-col justify-center h-full relative">
                <h2 class="text-xs md:text-sm text-orange-500 mb-1 tracking-widest uppercase font-bold">Subject Identification</h2>
                <div class="text-4xl md:text-6xl font-military text-gray-100 mb-4 uppercase tracking-tight">
                    {basics.name}
                </div>
                <div class="inline-block bg-orange-600/10 border border-orange-600/30 px-3 py-1 text-orange-400 font-bold tracking-widest text-sm w-fit">
                    [{basics.label}]
                </div>
                
                <div class="mt-6 pt-6 border-t border-zinc-700/50">
                    <p class="text-sm md:text-base text-gray-400 leading-relaxed max-w-2xl">
                        <span class="text-orange-500 font-bold mr-2">></span>
                        {basics.summary}
                    </p>
                </div>
            </div>
        </div>
    </section>


    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-4 space-y-6">
            
            <div class="bg-zinc-900/50 border border-zinc-800 p-4">
                 <h3 class="text-[10px] text-zinc-500 uppercase tracking-widest mb-3 font-bold flex items-center gap-2">
                    <span class="w-1 h-1 bg-green-500 rounded-full"></span>
                    COMM_LINKS
                </h3>
                 <div class="space-y-2">
                    {basics.email && (
                        <a href={`mailto:${basics.email}`} class="block text-xs text-green-400 bg-black/40 p-2 border-l-2 border-transparent hover:border-green-500 hover:bg-green-900/20 transition truncate">
                            EMAIL: {basics.email}
                        </a>
                    )}
                    {basics.location && (
                        <div class="block text-xs text-gray-400 bg-black/40 p-2 border-l-2 border-zinc-700 truncate">
                            LOC: {basics.location.city}, {basics.location.countryCode}
                        </div>
                    )}
                     {basics.profiles?.map(profile => (
                        <a href={profile.url} target="_blank" class="block text-xs text-orange-300 bg-black/40 p-2 border-l-2 border-transparent hover:border-orange-500 hover:bg-orange-900/20 transition truncate group">
                            NET: {profile.network} <span class="hidden group-hover:inline float-right">>></span>
                        </a>
                    ))}
                 </div>
            </div>

            <div class="bg-zinc-900/50 border border-zinc-800 p-1">
                <div class="bg-black/60 p-2 border-b border-zinc-800 flex items-center gap-2 mb-2">
                    <div class="w-4 h-4 text-orange-500"><Fragment set:html={HealthIcon} /></div>
                    <h3 class="text-orange-100 font-bold text-xs tracking-wider">H.E.V. SUIT MODULES</h3>
                </div>

                <div class="p-3 space-y-5">
                    {skills?.map(group => (
                        <div>
                            <div class="flex justify-between text-[10px] text-green-600 uppercase font-bold mb-1 border-b border-green-900/30">
                                <span>{group.name}</span>
                                <span>100%</span>
                            </div>
                            <div class="flex flex-wrap gap-1 mt-2">
                                {group.keywords.map(tech => (
                                    <span class="bg-zinc-800 text-gray-400 text-[10px] px-2 py-0.5 border border-zinc-700 hover:border-orange-500 hover:text-orange-100 cursor-crosshair transition-colors">
                                        {tech}
                                    </span>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            </div>

            <div class="h-6 w-full hazard-stripes border-y-2 border-black opacity-60"></div>
        </aside>


        <main class="lg:col-span-8 space-y-10">
            
            <section>
                <div class="flex items-center gap-3 mb-6 border-b border-zinc-800 pb-2">
                    <h3 class="font-military text-2xl text-gray-200 uppercase">Mission Logs</h3>
                    <div class="flex-1 h-px bg-zinc-800"></div>
                    <span class="text-[10px] text-orange-500 bg-orange-900/10 px-2 py-1 rounded border border-orange-900/30">CLASSIFIED</span>
                </div>

                <div class="space-y-4">
                    {work?.map((job) => (
                        <article class="relative pl-6 border-l-2 border-zinc-800 hover:border-orange-500 transition-colors duration-300 group">
                            <div class="absolute -left-[5px] top-0 w-2 h-2 bg-black border border-zinc-500 group-hover:border-orange-500 group-hover:bg-orange-500 transition-all"></div>
                            
                            <div class="bg-zinc-900/30 p-4 border border-zinc-800/50 hover:bg-zinc-900 transition">
                                <header class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 mb-2">
                                    <div>
                                        <h4 class="text-lg font-bold text-gray-100 group-hover:text-orange-400 transition">{job.position}</h4>
                                        <div class="text-xs text-green-500 font-bold uppercase">@ {job.name}</div>
                                    </div>
                                    <div class="text-[10px] font-mono bg-black border border-zinc-700 text-gray-500 px-2 py-1 whitespace-nowrap">
                                        {job.startDate} -> {job.endDate || 'ACTIVE'}
                                    </div>
                                </header>
                                <p class="text-sm text-gray-400 leading-relaxed mb-3">
                                    {job.summary}
                                </p>
                                {job.highlights && (
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        {job.highlights.map(h => (
                                            <span class="text-[10px] bg-zinc-800 text-zinc-400 px-2 py-0.5 rounded border border-zinc-700/50">
                                                {h}
                                            </span>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </article>
                    ))}
                </div>
            </section>

            <section>
                <div class="flex items-center gap-3 mb-6 border-b border-zinc-800 pb-2">
                    <h3 class="font-military text-2xl text-gray-200 uppercase">R&D Projects</h3>
                    <div class="flex-1 h-px bg-zinc-800"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {projects?.map(project => (
                        <div class="group relative bg-zinc-900 border border-zinc-700 hover:border-green-500/50 transition-all duration-300 flex flex-col">
                            <div class="absolute top-0 right-0 w-3 h-3 border-t border-r border-zinc-500 group-hover:border-green-500 transition-colors"></div>
                            <div class="absolute bottom-0 left-0 w-3 h-3 border-b border-l border-zinc-500 group-hover:border-green-500 transition-colors"></div>

                            <div class="p-5 flex flex-col h-full">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="text-base font-bold text-gray-200 group-hover:text-green-400 transition">{project.name}</h4>
                                    <span class={`text-[9px] px-1.5 py-0.5 border ${project.isActive ? 'border-green-600 text-green-500' : 'border-zinc-600 text-zinc-600'}`}>
                                        {project.isActive ? 'ACTIVE' : 'ARCHIVED'}
                                    </span>
                                </div>
                                <p class="text-xs text-gray-400 leading-relaxed mb-4 flex-1">
                                    {project.description}
                                </p>
                                <div class="flex gap-3 pt-3 border-t border-zinc-800 mt-auto">
                                    {project.url && (
                                        <a href={project.url} target="_blank" class="text-[10px] text-orange-500 font-bold hover:text-orange-300 uppercase flex items-center gap-1">
                                            [INITIATE] ↗
                                        </a>
                                    )}
                                    {project.github && (
                                        <a href={project.github} target="_blank" class="text-[10px] text-zinc-500 hover:text-white uppercase flex items-center gap-1">
                                            [SOURCE] 
                                        </a>
                                    )}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </section>
        </main>
    </div>
  </div>
</div>